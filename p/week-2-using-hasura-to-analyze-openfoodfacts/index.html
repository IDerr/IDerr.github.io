<!doctype html><html lang=en-us>
<head><meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="How to analyze and create an API easily for OpenFoodFacts !"><title>Week 2 - Using Hasura to analyze OpenFoodFacts</title>
<link rel=canonical href=https://iderr.github.io/p/week-2-using-hasura-to-analyze-openfoodfacts/>
<link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="Week 2 - Using Hasura to analyze OpenFoodFacts">
<meta property="og:description" content="How to analyze and create an API easily for OpenFoodFacts !">
<meta property="og:url" content="https://iderr.github.io/p/week-2-using-hasura-to-analyze-openfoodfacts/">
<meta property="og:site_name" content="IDerr">
<meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="OpenFoodFacts"><meta property="article:published_time" content="2021-11-19T00:00:00+00:00"><meta property="article:modified_time" content="2021-11-19T00:00:00+00:00"><meta property="og:image" content="https://iderr.github.io/p/week-2-using-hasura-to-analyze-openfoodfacts/background.png">
<meta name=twitter:title content="Week 2 - Using Hasura to analyze OpenFoodFacts">
<meta name=twitter:description content="How to analyze and create an API easily for OpenFoodFacts !"><meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://iderr.github.io/p/week-2-using-hasura-to-analyze-openfoodfacts/background.png">
<script data-id=matomo-tracking data-matomo-tracking-url=https://analytics.derraz.fr data-matomo-tracking-id=1 src=/js/matomo-tracking.min.46acc2e1e3847ae7ddaaf1adb19b2d5755a94ebfc905716dea057f60061bcfac.js integrity="sha256-RqzC4eOEeufdqvGtsZstV1WpTr/JBXFt6gV/YAYbz6w=" crossorigin=anonymous defer></script>
</head>
<body class="article-page has-toc">
<script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"dark")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.documentElement.dataset.scheme='dark':document.documentElement.dataset.scheme='light'})()</script>
<div class="container main-container flex
extended">
<div id=article-toolbar>
<a href=/ class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg>
<span>Back</span>
</a>
</div>
<main class="main full-width">
<article class="has-image main-article">
<header class=article-header>
<div class=article-image>
<a href=/p/week-2-using-hasura-to-analyze-openfoodfacts/>
<img src=/p/week-2-using-hasura-to-analyze-openfoodfacts/background_hu7f4aefc3a426d3b4990b4956a4ec486a_256879_800x0_resize_box_3.png srcset="/p/week-2-using-hasura-to-analyze-openfoodfacts/background_hu7f4aefc3a426d3b4990b4956a4ec486a_256879_800x0_resize_box_3.png 800w, /p/week-2-using-hasura-to-analyze-openfoodfacts/background_hu7f4aefc3a426d3b4990b4956a4ec486a_256879_1600x0_resize_box_3.png 1600w" width=800 height=450 loading=lazy alt="Featured image of post Week 2 - Using Hasura to analyze OpenFoodFacts">
</a>
</div>
<div class=article-details>
<header class=article-category>
<a href=/categories/food/>
Food
</a>
<a href=/categories/openfoodfacts/>
OpenFoodFacts
</a>
</header>
<h2 class=article-title>
<a href=/p/week-2-using-hasura-to-analyze-openfoodfacts/>Week 2 - Using Hasura to analyze OpenFoodFacts</a>
</h2>
<h3 class=article-subtitle>
How to analyze and create an API easily for OpenFoodFacts !
</h3>
<footer class=article-time>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Nov 19, 2021</time>
</div>
<div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>
3 minute read
</time>
</div>
</footer>
</div>
</header>
<section class=article-content>
<h2 id=introduction>Introduction</h2>
<p>In the last article, we have imported OpenFoodFacts data from a CSV format to PostgreSQL.</p>
<p>Now, our data is ready to be analysed by anyone.
SQL can be great for analysis but if we want to build an application, we&rsquo;ll need another transport layer like REST or GraphQL.
So in this article, I&rsquo;ll show you how create a quick GraphQL API using <a class=link href=https://hasura.io/ target=_blank rel=noopener>Hasura</a></p>
<p>You can find all my work on my Github : <a class=link href=https://github.com/IDerr/Openfoodfacts target=_blank rel=noopener>https://github.com/IDerr/Openfoodfacts</a></p>
<h2 id=what-is-hasura>What is Hasura</h2>
<p>Hasura is a GraphQL engine that can be connected to your database and result in a unified data access layer, here GraphQL.</p>
<p>If you&rsquo;re interested by the project, you can find a lot more informations on their website !</p>
<h2 id=installation>Installation</h2>
<p>Installation of hasura is pretty straight forward, I&rsquo;ll use Docker-compose to simplify this process.</p>
<p>Here&rsquo;s the docker-compose I&rsquo;ve used to create my hasura engine</p>
<pre tabindex=0><code>version: '3.6'
services:
  graphql-engine:
    image: hasura/graphql-engine:v2.0.10
    ports:
      - 8080:8080
    restart: always
    environment:
      ## postgres database to store Hasura metadata
      HASURA_GRAPHQL_METADATA_DATABASE_URL: postgresql://username:password@hostname:5432/mymetadatadatabase
      ## this env var can be used to add the above postgres database to Hasura as a data source. this can be removed/updated based on your needs
      PG_DATABASE_URL: postgresql://username:password@hostname:5432/openfoodfacts
      ## enable the console served by server
      HASURA_GRAPHQL_ENABLE_CONSOLE: &quot;true&quot; # set to &quot;false&quot; to disable console
      ## enable debugging mode. It is recommended to disable this in production
      HASURA_GRAPHQL_DEV_MODE: &quot;true&quot;
      HASURA_GRAPHQL_ENABLED_LOG_TYPES: startup, http-log, webhook-log, websocket-log, query-log
      ## uncomment next line to set an admin secret
      # HASURA_GRAPHQL_ADMIN_SECRET: myadminsecretkey
</code></pre><p>Now you run the tool easily with</p>
<pre tabindex=0><code>docker-compose up -d 
</code></pre><p><figure class=gallery-image style=flex-grow:73;flex-basis:176px>
<a href=/p/week-2-using-hasura-to-analyze-openfoodfacts/2.jpg data-size=876x1189>
<img src=/p/week-2-using-hasura-to-analyze-openfoodfacts/2.jpg width=876 height=1189 srcset="/p/week-2-using-hasura-to-analyze-openfoodfacts/2_hu4052cdfc130d7e3aac07c786d212cc93_98152_480x0_resize_q75_box.jpg 480w, /p/week-2-using-hasura-to-analyze-openfoodfacts/2_hu4052cdfc130d7e3aac07c786d212cc93_98152_1024x0_resize_q75_box.jpg 1024w" loading=lazy alt=1.jpg>
</a>
<figcaption>1.jpg</figcaption>
</figure></p>
<p>TADAA, you know have a hasura engine ready, just type <code> http://youhostname:8080/console</code>
You&rsquo;ll be welcomed with a super UI.</p>
<p>You can now go to the &ldquo;Data&rdquo; section where you can setup the relationship between your database and Hasura.</p>
<p><figure class=gallery-image style=flex-grow:73;flex-basis:176px>
<a href=/p/week-2-using-hasura-to-analyze-openfoodfacts/2.jpg data-size=876x1189>
<img src=/p/week-2-using-hasura-to-analyze-openfoodfacts/2.jpg width=876 height=1189 srcset="/p/week-2-using-hasura-to-analyze-openfoodfacts/2_hu4052cdfc130d7e3aac07c786d212cc93_98152_480x0_resize_q75_box.jpg 480w, /p/week-2-using-hasura-to-analyze-openfoodfacts/2_hu4052cdfc130d7e3aac07c786d212cc93_98152_1024x0_resize_q75_box.jpg 1024w" loading=lazy alt=2.jpg>
</a>
<figcaption>2.jpg</figcaption>
</figure></p>
<p>Just track everything to link all tables !</p>
<p>Then it&rsquo;ll automatically detect all the links between tables, track them also.</p>
<p><figure class=gallery-image style=flex-grow:84;flex-basis:203px>
<a href=/p/week-2-using-hasura-to-analyze-openfoodfacts/3.jpg data-size=636x749>
<img src=/p/week-2-using-hasura-to-analyze-openfoodfacts/3.jpg width=636 height=749 srcset="/p/week-2-using-hasura-to-analyze-openfoodfacts/3_hu66674bae8d0734084fd7dfcb22298bd5_155404_480x0_resize_q75_box.jpg 480w, /p/week-2-using-hasura-to-analyze-openfoodfacts/3_hu66674bae8d0734084fd7dfcb22298bd5_155404_1024x0_resize_q75_box.jpg 1024w" loading=lazy alt=3.jpg>
</a>
<figcaption>3.jpg</figcaption>
</figure></p>
<p>After that, you can come back in the &ldquo;API&rdquo; section and your API is ready !</p>
<p>We can now easily create our GraphQL requests, for example all products that doesn&rsquo;t have a creator</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-graphql data-lang=graphql><span class=kd>query</span><span class=w> </span><span class=nc>GetProductsWithoutCreator</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>  </span><span class=py>Product</span><span class=p>(</span><span class=py>where</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=nc>creator</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=nc>_is_null</span><span class=p>:</span><span class=w> </span><span class=nc>true</span><span class=p>}}){</span><span class=w>
</span><span class=w>    </span><span class=py>code</span><span class=w>
</span><span class=w>    </span><span class=py>creator</span><span class=w>
</span><span class=w>    </span><span class=py>product_name</span><span class=w>
</span><span class=w>  </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div><p><figure class=gallery-image style=flex-grow:283;flex-basis:679px>
<a href=/p/week-2-using-hasura-to-analyze-openfoodfacts/4.jpg data-size=1821x643>
<img src=/p/week-2-using-hasura-to-analyze-openfoodfacts/4.jpg width=1821 height=643 srcset="/p/week-2-using-hasura-to-analyze-openfoodfacts/4_huc5951a890f0663c9222f2c1639a69718_89499_480x0_resize_q75_box.jpg 480w, /p/week-2-using-hasura-to-analyze-openfoodfacts/4_huc5951a890f0663c9222f2c1639a69718_89499_1024x0_resize_q75_box.jpg 1024w" loading=lazy alt=4.jpg>
</a>
<figcaption>4.jpg</figcaption>
</figure></p>
<p>Oh, we have found 4 products without any creator, weird&mldr;</p>
<p>We can now report that to the OpenFood facts team :)</p>
<p>Analysis can be done very quicky with tools like this, and if we want to build an Android app, our API will be ready to go !</p>
<h2 id=next-steps>Next steps</h2>
<p>Next steps, develop more GraphQL queries to find inconsistent data & improve the data model.
I&rsquo;ll focus on that now !</p>
<p>Also, that we have our API, we can try to make a simple app to try the integration with Hasura.</p>
<h2 id=conclusion>Conclusion</h2>
<p>I&rsquo;ll continue working on my side, if anyone would like to help me on this project, feel free to create issues and PR on the github repository.
I am also available on Openfoodfacts Slack (IDerr), if there&rsquo;s any questions!</p>
<p>See you next week for the next article (on OpenFoodFacts)!</p>
</section>
<footer class=article-footer>
<section class=article-tags>
<a href=/tags/openfoodfacts/>OpenFoodFacts</a>
</section>
<section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span>
</section>
</footer>
</article>
<aside class=related-contents--wrapper>
<h2 class=section-title>Related contents</h2>
<div class=related-contents>
<div class="flex article-list--tile">
<article class=has-image>
<a href=/p/week-1-new-project-on-openfoodfacts/>
<div class=article-image>
<img src=/p/week-1-new-project-on-openfoodfacts/background.9489f8844fcc4389a92a5afbdf194948_hu49c03114a9ce8ad2bc0bd62c0ddb3f2a_750790_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy data-key data-hash="md5-lIn4hE/MQ4mpKlr73xlJSA==">
</div>
<div class=article-details>
<h2 class=article-title>Week 1 - New project on OpenFoodFacts</h2>
</div>
</a>
</article>
</div>
</div>
</aside>
<footer class=site-footer>
<section class=copyright>
&copy;
2021 IDerr
</section>
<section class=powerby>
Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> <br>
Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.5.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a>
</section>
</footer>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous>
</main>
<aside class="sidebar right-sidebar sticky">
<section class="widget archives">
<div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
</div>
<h2 class="widget-title section-title">Table of contents</h2>
<div class=widget--toc>
<nav id=TableOfContents>
<ol>
<li><a href=#introduction>Introduction</a></li>
<li><a href=#what-is-hasura>What is Hasura</a></li>
<li><a href=#installation>Installation</a></li>
<li><a href=#next-steps>Next steps</a></li>
<li><a href=#conclusion>Conclusion</a></li>
</ol>
</nav>
</div>
</section>
</aside>
</div>
<script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script>
</body>
</html>